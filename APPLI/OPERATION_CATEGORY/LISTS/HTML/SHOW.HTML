<!--<!DOCTYPE html>-->
<!--<html>-->

<div id="whole" class="container fade-in" style="opacity:0">
    
    <!--Header Info-->
    <div class="col-md-1 col-xs-1" >
        <i class="glyphicon glyphicon-info-sign"></i>
    </div>
 
    <!--Header Info-->
    <div class="col-md10 lbl-header-info">
        <span id="info-msg" class="label label-lg label-###INFO_LV###">
            ###INFO_MSG###
        </span>
    </div>
    <!--ERROR MESSAGE-->
    <div class="row">
        <div class="col-md-10 lbl-header-info">
            <div>
                <span id="OPERATION_CATEGORY_NM_EN_ISNULL_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_EN_ISNULL###">カテゴリ名(英語)に、値がありません。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_EN_LENGTH_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_EN_LENGTH###">カテゴリ名(英語)は、3文字以上必要です。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_EN_ISEN_ISJP_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_EN_ISEN_ISJP###">カテゴリ名(英語)に、英数字以外が入力されています。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_EN_DUPLICATE_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_EN_DUPLICATE###">カテゴリ名(英語)は、既に使用されています。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_JP_ISNULL_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_JP_ISNULL###">カテゴリ名(日本語)に、値がありません。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_JP_LENGTH_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_JP_LENGTH###">カテゴリ名(日本語)、3文字以上必要です。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_JP_ISEN_ISJP_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_JP_ISEN_ISJP###">カテゴリ名(日本語)に、日本語が入力されていません。</span>
            </div>
            <div>
                <span id="OPERATION_CATEGORY_NM_JP_DUPLICATE_MSG" class="fade-in label label-danger ###OPERATION_CATEGORY_NM_JP_DUPLICATE###">カテゴリ名(日本語)は、既に使用されています。</span>
            </div>
        </div>
    </div>
    <br>

    <!--Spacer
    <div class="header-dummy" style="height:7.0em; background-color:piiiiink;"></div>
    -->

    <!--Contents-->
    <div class="header-under-contents">
        <form class="form-horizontal" action="" method="">
            <input type="hidden" id="ACTION" name="ACTION" value="COMPLETE" >
            <input type="hidden" id="REST" name="REST" value="" >
            <div class="contents-table">
                ###TABLE###
            </div>
        </form>
    </div>
</div>
<!--</html>-->

<script>

    //Validation Err MSGのOpacityを初期化
    $(document).ready(function(){
        validationErrMsgInit();
    });

    //ロード時に全画面をフェードイン
    $(window).on('load',function(){
        $('#whole').css("opacity","1");
    });

    //バリデーションエラーMSGの初期化
    function validationErrMsgInit() {

        //バリデーションエラー表示をクリア
        $('input[type=text]').removeClass("label-danger");
        $('.lbl-header-info .label').removeClass("show");
        $('.lbl-header-info .label').addClass("hidden");
        $('#info-msg').html("");

        //バリデーションエラーMSGをフェードアウト
        fadeInOut(0);
   }

    /*バリデーションエラーMSGをフェードアウト
    *   引数 inout
    *   フェードイン:1
    *   フェードアウト:0
    */
    function fadeInOut(inout) {
        $('.fade-in').not('#whole').each(function(){
            $(this).css("opacity",inout );
        });
    }

    //
    $('.btn').on('click', function() {
    });

    //カテゴリ名新規追加
    function newOperationCategory() {

        //バリデーションエラーMSG初期化
        validationErrMsgInit();

        //新規登録処理
        $('#REST').val('POST'); //REST
        var new_category_nm_en = $('#OPERATION_CATEGORY_NM_EN_NEW').val(); //MSG用
        var params = $('form').serialize();
        jqXHR = $.ajax({
            type: 'POST',
            url: '/APP/OPERATION_CATEGORY/NEW',
            data: params
        });
        jqXHR.done(function(data) {
            //バリデーションエラーの場合、先頭にVALID=NG
            //デリミタとして「@」を指定されてくる
            var valid_result = data.split("@");
            if (valid_result[0] == 'VALID_NG') {

                //バリデーションエラー表示
                var r = validationResultDisplay('NEW', valid_result[1], 'POST');

                //バリデーションMSGをフワッと表示 
                fadeInOut(1);

                if (r != 'OK') {  
                    alert("新規登録処理に失敗しました。");
                }
            } else {
                $('table').html(data);
                $('#info-msg').html(new_category_nm_en + "を追加しました。");
                alert(new_category_nm_en + "を追加しました。");
            }
        });
        jqXHR.fail(function(data) {
            alert("新規登録処理に失敗しました。");
        });
    }

    //カテゴリ名変更
    function editOperationCategory(id) {

        //バリデーションエラーMSG初期化
        validationErrMsgInit();

        if (id == 999) {
            alert("更新対象です。");
            return false;
        }

        //更新処理
        var edit_category_nm_en = $('#OPERATION_CATEGORY_NM_EN_' + id).val();
        var edit_category_nm_jp = $('#OPERATION_CATEGORY_NM_JP_' + id).val();
        var params = $('form').serialize();
        var jqXHR = $.ajax({
            type: 'POST',
            url: '/APP/OPERATION_CATEGORY/EDIT',
            data: {
                REST: 'PUT',
                ACTION: 'COMPLETE',
                OPERATION_CATEGORY_ID: id,
                OPERATION_CATEGORY_NM_EN: edit_category_nm_en,
                OPERATION_CATEGORY_NM_JP: edit_category_nm_jp
            }
        });
        jqXHR.done(function(data) {
            //バリデーションエラーの場合、先頭にVALID=NG
            //デリミタとして「@」をが指定されてくる
            var valid_result = data.split("@");
            if (valid_result[0] == 'VALID_NG') {

                //バリデーションエラー表示
                var r = validationResultDisplay(id, valid_result[1], 'PUT');

                //バリデーションMSGをフワッと表示 
                fadeInOut(1);
                
                if (r != 'OK') {  
                    alert("更新処理に失敗しました。");
                }
            } else {
                $('#info-msg').html(edit_category_nm_en + "に変更しました。");
                alert(edit_category_nm_en + "に変更しました。");
            }
        });
        jqXHR.fail(function() {
            alert("更新処理に失敗しました。");
        });
    }

    //カテゴリ名削除
    function deleteOperationCategory(id) {

        //バリデーションエラーMSG初期化
        validationErrMsgInit();
 
        if (id == 999) {
            alert("削除対象外です。");
            return false;
        }

        //削除処理
        var delete_category_nm_en = $('#OPERATION_CATEGORY_NM_EN_' + id).val();
        var params = $('form').serialize();
        var jqXHR = $.ajax({
            type: 'POST',
            url: '/APP/OPERATION_CATEGORY/DELETE',
            data: {
                REST: 'DELETE',
                ACTION: 'COMPLETE',
                OPERATION_CATEGORY_ID: id,
                OPERATION_CATEGORY_NM_EN: delete_category_nm_en
            }
        });
        jqXHR.done(function(data) {
            if (data == 111) {
                var sel = '#edit-row-' + id;
                $(sel).remove();
                alert('No:' + id + 'の'+ delete_category_nm_en + "を削除しました。");
                $('#info-msg').html('No:' + id + 'の' + delete_category_nm_en + "を削除しました。");
            } else {
                alert('No:' + id + 'の' +  delete_category_nm_en + "を削除出来ませんでした。");
                $('#info-msg').html('No:' + id + 'の' +  delete_category_nm_en + "を削除出来ませんでした。");
            }
        });
        jqXHR.fail(function() {
            alert("削除処理に失敗しました。");
        });
 
    }

</script>
<!--</html>-->
