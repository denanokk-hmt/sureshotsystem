<!--<!DOCTYPE html>-->
<!--<html>-->

<div class="container">

    <!--Header Info& Goto subpage button-->
    <div class="fixed gray-trans-over z-index-3" style="padding:10px;">

        <!--Infomation-->
        <div class="row">
            <label class="control-label col-sm-1">
                <h3><i class="glyphicon glyphicon-info-sign"></i></h3>
            </label>
            <div class="col-sm-6 lbl-header-info">
                <span id="info-msg" class="label label-lg ">
                    ###INFO_MSG###
                </span>
            </div>
        </div>

        <!--Goto Subpage-->
        <div class="btn-toolbar">
            <button class="btn btn-subpage btn-info col-smx-3 disabled" />Set</button>
            <button class="btn btn-subpage btn-default col-smx-3 " />Operation</button>
            <button class="btn btn-subpage btn-default col-smx-3 " />Parts</button>
            <button class="btn btn-subpage btn-success col-smx-3 " />Confirm</button>
        </div>

    </div>

    <!--Spacer-->
    <div class="header-dummy" style="height:9.0em; background-color:piink;"></div>

    <!--Contents Records/Pagination-->
    <div class="header-under-contents">
        <form id="set_list" class="form-inline form-horizontal"  action="" method="">
            <input type="hidden" name="SET_CATEGORY_NO_HID" id="SET_CATEGORY_NO_HID" value="###SET_CATEGORY_NO_ORG###" class="form-control" />
            <input type="hidden" name="SET_NO_HID" id="SET_NO_HID" value="###SET_NO###" class="form-control" />
        </form>
        <div class="contents-table">
            ###TABLE###
        </div>
    </div>
</div>

<script>

    //ページ移動
    $(".btn-toolbar .btn-subpage").on('click', function() {
        var func = $(this).html().toUpperCase();
        var frm = document.forms['set_list'];
        frm.method = 'GET';
        frm.action = '/APP/SET_LIST/EDIT/' + func + '/INPUT';
        frm.submit();
    });

    //カテゴリを選択
    $(document).on('click', 'a.category-list', function() {

        //選択した部品のidから行を取得する
        var idname = $(this).attr("id"); 
        var list_id = idname.split("_");
        var row = $(this).parent().parent().attr("name");
        var cat_no = list_id[2];
        var choice = $(this).text();

        //該当のレコードに選択したカテゴリ名を設定
        $('#SET_CATEGORY_NM_' + row).val(choice);
        $('#SET_CATEGORY_NO_HID_' + row).val(cat_no);

    });

    //EDITボタン
    $(document).on('click', 'a.btn-set', function() {

        //イベント基本情報
        //selecter id format: kind_action_row
        var idname = $(this).attr("id"); 
        var list_id = idname.split("_");
        var action = list_id[1];
        var row = list_id[2];

        //値
        var set_category_no = $('#SET_CATEGORY_NO_HID_' + row).val();
        var set_category_nx = $('#SET_CATEGORY_NX_HID_' + row).val();
        var set_category_nm = $('#SET_CATEGORY_NM_' + row).val();
        var set_no = $('#SET_NO_HID_' + row).val();
        var set_nm = $('#SET_NM_' + row).val();
        var set_nm_nx = $('#SET_NM_NX_HID_' + row).val();
        var set_price = $('#SET_PRICE_' + row).val();
        var set_price_nx = $('#SET_PRICE_NX_HID_' + row).val();
        var set_remarks = $('#SET_REMARKS_' + row).val();
        var set_remarks_nx = $('#SET_REMARKS_NX_HID_' + row).val();

        //Validation
        if (!set_category_no) {
            alert("セットカテゴリが選択されていません。");
            return;
        }
        //Validation
        if (!set_nm) {
            alert("セット名が入力されていません。");
            return;
        }
        //Validation
        if (set_nm.indexOf("&") != -1) {
            alert("{&}文字は入力出来ません。");
            return;
        }
        //Validation
        if (!set_price) {
            alert("セットの金額が入力されていません。");
            return;
        }
        //Validation
        if (set_category_no == set_category_nx && 
            set_nm == set_nm_nx &&
            set_price == set_price_nx &&
            set_remarks == set_remarks_nx
          ) {
            alert("変更箇所がありません。");
            return;
        }

        //セット名を仮登録
        var jqXHR = $.ajax({
            type: 'POST',
            url: '/APP/SET_LIST/EDIT/SET/COMPLETE',
            data: {
              ROW: row,
              SET_CATEGORY_NO: set_category_no,
              SET_CATEGORY_NX: set_category_nx,
              SET_CATEGORY_NM: set_category_nm,
              SET_NO: set_no,
              SET_NM: set_nm,
              SET_NM_NX: set_nm_nx,
              SET_PRICE: set_price,
              SET_REMARKS: set_remarks
            }
        });
        jqXHR.done(function(data) {
            if (data == 2222) {
                alert("セット名:" + set_nm + "は、既に使用されています。");
            } else {
                $('intput[type="text"]').each(function() {
                });
                alert("セット:" + set_no + "の変更を仮登録しました。");
            }
        });
        jqXHR.fail(function(data) {
            alert("セット:" + set_no + "の仮登録に失敗しました。");
        });
    });


</script>
<!--</html>-->
